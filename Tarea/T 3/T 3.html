<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>T 3</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="T 3_files/libs/clipboard/clipboard.min.js"></script>
<script src="T 3_files/libs/quarto-html/quarto.js"></script>
<script src="T 3_files/libs/quarto-html/popper.min.js"></script>
<script src="T 3_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="T 3_files/libs/quarto-html/anchor.min.js"></script>
<link href="T 3_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="T 3_files/libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="T 3_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="T 3_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="T 3_files/libs/bootstrap/bootstrap-1bc8a17f135ab3d594c857e9f48e611b.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article toc-left">
<div id="quarto-sidebar-toc-left" class="sidebar toc-left">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#hw-3-stylized-asset-return-facts" id="toc-hw-3-stylized-asset-return-facts" class="nav-link active" data-scroll-target="#hw-3-stylized-asset-return-facts"><span class="header-section-number">1</span> HW 3: Stylized Asset Return Facts</a>
  <ul class="collapse">
  <li><a href="#libraries" id="toc-libraries" class="nav-link" data-scroll-target="#libraries"><span class="header-section-number">1.1</span> Libraries</a></li>
  <li><a href="#assets-selection" id="toc-assets-selection" class="nav-link" data-scroll-target="#assets-selection"><span class="header-section-number">1.2</span> <strong>Assets Selection</strong></a></li>
  <li><a href="#data-import" id="toc-data-import" class="nav-link" data-scroll-target="#data-import"><span class="header-section-number">1.3</span> Data Import</a>
  <ul class="collapse">
  <li><a href="#returns" id="toc-returns" class="nav-link" data-scroll-target="#returns"><span class="header-section-number">1.3.1</span> Returns</a></li>
  <li><a href="#prices-hist" id="toc-prices-hist" class="nav-link" data-scroll-target="#prices-hist"><span class="header-section-number">1.3.2</span> Prices Hist</a></li>
  </ul></li>
  <li><a href="#time-series" id="toc-time-series" class="nav-link" data-scroll-target="#time-series"><span class="header-section-number">1.4</span> <strong>Time Series</strong></a>
  <ul class="collapse">
  <li><a href="#prices-series-plot" id="toc-prices-series-plot" class="nav-link" data-scroll-target="#prices-series-plot"><span class="header-section-number">1.4.1</span> Prices Series Plot</a></li>
  <li><a href="#return-series-plot" id="toc-return-series-plot" class="nav-link" data-scroll-target="#return-series-plot"><span class="header-section-number">1.4.2</span> Return Series Plot</a></li>
  <li><a href="#daily" id="toc-daily" class="nav-link" data-scroll-target="#daily"><span class="header-section-number">1.4.3</span> <strong>Daily</strong></a></li>
  <li><a href="#anual" id="toc-anual" class="nav-link" data-scroll-target="#anual"><span class="header-section-number">1.4.4</span> <strong>Anual</strong></a></li>
  <li><a href="#by-period" id="toc-by-period" class="nav-link" data-scroll-target="#by-period"><span class="header-section-number">1.4.5</span> <strong>By Period</strong></a></li>
  </ul></li>
  <li><a href="#hypothesis-test" id="toc-hypothesis-test" class="nav-link" data-scroll-target="#hypothesis-test"><span class="header-section-number">1.5</span> Hypothesis Test</a>
  <ul class="collapse">
  <li><a href="#second-hypothesis-test" id="toc-second-hypothesis-test" class="nav-link" data-scroll-target="#second-hypothesis-test"><span class="header-section-number">1.5.1</span> <strong>Second hypothesis test</strong></a></li>
  </ul></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion"><span class="header-section-number">1.6</span> Conclusion</a></li>
  </ul></li>
  </ul>
</nav>
</div>
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">T 3</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="hw-3-stylized-asset-return-facts" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> HW 3: Stylized Asset Return Facts</h1>
<section id="libraries" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="libraries"><span class="header-section-number">1.1</span> Libraries</h2>
</section>
<section id="assets-selection" class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="assets-selection"><span class="header-section-number">1.2</span> <strong>Assets Selection</strong></h2>
<ul>
<li><p><strong>AAPL (Apple Inc.)</strong>: It’s a high-tech company that is traded on the NASDAQ (<strong><em>United States</em></strong>).</p></li>
<li><p><strong>NESN.SW (Nestlé S.A.)</strong>: It’s a multinational food and beverage company that is traded on the SIX Swiss Exchange (<strong><em>Switzerland</em></strong>).</p></li>
<li><p><strong>7203.T (Toyota Motor Corp.)</strong>: It’s a leading automotive company that is traded on the Tokyo Stock Exchange (TSE) (<strong><em>Japan</em></strong>).</p></li>
</ul>
</section>
<section id="data-import" class="level2" data-number="1.3">
<h2 data-number="1.3" class="anchored" data-anchor-id="data-import"><span class="header-section-number">1.3</span> Data Import</h2>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>[1] "AAPL"    "NESN.SW" "7203.T" </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>               AAPL  NESN.SW   7203.T
2010-10-01 8.481282 33.41576 398.2422
2010-10-04 8.364802 33.31992 395.4386
2010-10-05 8.674012 33.51160 397.1741
2010-10-06 8.681520 33.67133 394.1035
2010-10-07 8.682421 33.79911 394.2370
2010-10-08 8.828016 33.54355 386.4937</code></pre>
</div>
</div>
<section id="returns" class="level3" data-number="1.3.1">
<h3 data-number="1.3.1" class="anchored" data-anchor-id="returns"><span class="header-section-number">1.3.1</span> Returns</h3>
</section>
<section id="prices-hist" class="level3" data-number="1.3.2">
<h3 data-number="1.3.2" class="anchored" data-anchor-id="prices-hist"><span class="header-section-number">1.3.2</span> Prices Hist</h3>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="T-3_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="T-3_files/figure-html/unnamed-chunk-4-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="T-3_files/figure-html/unnamed-chunk-4-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="T-3_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="T-3_files/figure-html/unnamed-chunk-5-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="T-3_files/figure-html/unnamed-chunk-5-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="time-series" class="level2" data-number="1.4">
<h2 data-number="1.4" class="anchored" data-anchor-id="time-series"><span class="header-section-number">1.4</span> <strong>Time Series</strong></h2>
<section id="prices-series-plot" class="level3" data-number="1.4.1">
<h3 data-number="1.4.1" class="anchored" data-anchor-id="prices-series-plot"><span class="header-section-number">1.4.1</span> Prices Series Plot</h3>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="T-3_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="T-3_files/figure-html/unnamed-chunk-6-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="T-3_files/figure-html/unnamed-chunk-6-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="return-series-plot" class="level3" data-number="1.4.2">
<h3 data-number="1.4.2" class="anchored" data-anchor-id="return-series-plot"><span class="header-section-number">1.4.2</span> Return Series Plot</h3>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="T-3_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="T-3_files/figure-html/unnamed-chunk-7-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="T-3_files/figure-html/unnamed-chunk-7-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="daily" class="level3" data-number="1.4.3">
<h3 data-number="1.4.3" class="anchored" data-anchor-id="daily"><span class="header-section-number">1.4.3</span> <strong>Daily</strong></h3>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>          Daily_Mean    Daily_SD
AAPL    0.0007794972 0.017814506
NESN.SW 0.0001771267 0.009977542
7203.T  0.0003629387 0.016880994</code></pre>
</div>
</div>
</section>
<section id="anual" class="level3" data-number="1.4.4">
<h3 data-number="1.4.4" class="anchored" data-anchor-id="anual"><span class="header-section-number">1.4.4</span> <strong>Anual</strong></h3>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>        Annualized_Mean Annualized_SD
AAPL         0.19643329     0.2827965
NESN.SW      0.04463593     0.1583886
7203.T       0.09146054     0.2679775</code></pre>
</div>
</div>
</section>
<section id="by-period" class="level3" data-number="1.4.5">
<h3 data-number="1.4.5" class="anchored" data-anchor-id="by-period"><span class="header-section-number">1.4.5</span> <strong>By Period</strong></h3>
</section>
</section>
<section id="hypothesis-test" class="level2" data-number="1.5">
<h2 data-number="1.5" class="anchored" data-anchor-id="hypothesis-test"><span class="header-section-number">1.5</span> Hypothesis Test</h2>
<p><span class="math display">\[ H_0 : \text{Hay Normalidad} \]</span></p>
<p><span class="math display">\[ H_i : \text{No Hay Normalidad} \]</span></p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>
Ticker: AAPL 

    Jarque-Bera Normality Test

data:  serie
JB = 6426.6, p-value &lt; 2.2e-16
alternative hypothesis: greater


---

Ticker: NESN.SW 

    Jarque-Bera Normality Test

data:  serie
JB = 2743.2, p-value &lt; 2.2e-16
alternative hypothesis: greater


---

Ticker: 7203.T 

    Jarque-Bera Normality Test

data:  serie
JB = 4876.3, p-value &lt; 2.2e-16
alternative hypothesis: greater


---</code></pre>
</div>
</div>
<p>According to the results of the Jarque–Bera test, we can statistically reject the null hypothesis, since the p-value is practically zero. Therefore, it can be concluded that the returns of the three tickers do not follow a normal distribution. This implies that the returns exhibit much more extreme values in their tails, which confirms one of the well-known stylized facts of financial time series. There’s no normality.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>
Ticker: AAPL 
Skewness: -0.1149126 
Kurtosis: 10.00371 

---

Ticker: NESN.SW 
Skewness: -0.3404793 
Kurtosis: 7.527345 

---

Ticker: 7203.T 
Skewness: 0.1450776 
Kurtosis: 9.09715 

---</code></pre>
</div>
</div>
<p>For the skewness, it can be concluded that the returns of Apple and Nestlé tend to exhibit more extreme values on the negative side, while the returns of Toyota show a tendency toward more extreme values on the positive side. Regarding the kurtosis, the results indicate a leptokurtic distribution, meaning that all three assets display much more extreme values in their tails compared to a normal distribution.</p>
<section id="second-hypothesis-test" class="level3" data-number="1.5.1">
<h3 data-number="1.5.1" class="anchored" data-anchor-id="second-hypothesis-test"><span class="header-section-number">1.5.1</span> <strong>Second hypothesis test</strong></h3>
<p><span class="math display">\[ H_o: \mu =  0 \]</span></p>
<p><span class="math display">\[ H_i : \mu \neq0 \]</span></p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>
Ticker: AAPL 

    One Sample t-test

data:  serie
t = 2.4523, df = 3140, p-value = 0.01425
alternative hypothesis: true mean is not equal to 0
95 percent confidence interval:
 0.0001562572 0.0014027372
sample estimates:
   mean of x 
0.0007794972 


---

Ticker: NESN.SW 

    One Sample t-test

data:  serie
t = 0.99493, df = 3140, p-value = 0.3198
alternative hypothesis: true mean is not equal to 0
95 percent confidence interval:
 -0.0001719373  0.0005261908
sample estimates:
   mean of x 
0.0001771267 


---

Ticker: 7203.T 

    One Sample t-test

data:  serie
t = 1.205, df = 3140, p-value = 0.2283
alternative hypothesis: true mean is not equal to 0
95 percent confidence interval:
 -0.0002276425  0.0009535198
sample estimates:
   mean of x 
0.0003629387 


---</code></pre>
</div>
</div>
<p>According to the results of the test, at the 1% significance level, the null hypothesis cannot be rejected for any of the tickers, since the daily returns are not statistically different from zero. This reinforces the stylized fact that financial returns tend to have means close to zero.</p>
<hr>
</section>
</section>
<section id="conclusion" class="level2" data-number="1.6">
<h2 data-number="1.6" class="anchored" data-anchor-id="conclusion"><span class="header-section-number">1.6</span> Conclusion</h2>
<p>In conclusion, the three selected assets exhibit the four stylized facts of financial returns. First, prices follow a behavior close to a random walk, reflecting the lack of memory in the series and the efficiency of price formation. Second, returns display bell-shaped distributions but deviate from normality, showing heavy tails and skewness. Third, volatility is not constant but appears in the form of clustering, with periods of high instability followed by further volatility, and calm periods grouped together. Finally, the distributions show leptokurtosis, meaning a greater concentration of values near the mean and more extreme tails compared to the normal distribution.</p>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>