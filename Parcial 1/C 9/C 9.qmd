---
title: "C 9"
format: html
editor: visual
---

## Actividad en Clase : Probabilidades

### Librerías

```{r}
library('quantmod')
library('tidyverse')
library('openxlsx')
```

```{r}
#Fechas
first_date <- as.Date("2024-01-01")
final_date <- as.Date("2025-09-22")

# Datos
AAPL <- getSymbols("AAPL", src="yahoo", from=first_date, to=final_date, auto.assign=FALSE)
head(AAPL)
```

Rendimientos

```{r}
rendimiento <- diff(log(AAPL$AAPL.Adjusted))
rendimiento <- na.omit(rendimiento)


```

```{r}
hist(rendimiento, xlab = "Rangos de Rendimiento", ylab= "Frecuencia", main= paste("Histograma") , col= "salmon", n=100)
```

Obtener $\mu$ y $\sigma$ anual

```{r}

mu <- mean(rendimiento)*252
sigma <- sd(rendimiento) * sqrt(252)

mu 
sigma
```

Obtener So , valor inicial ayer

```{r}
So <-  as.numeric(last(Cl(AAPL)))
So

```

-   Simular para encontrar las sig. Proba

-   6 Meses

    ```{r}
    T <- 0.5         
    n <- T / dt 
    t <- seq(0, T, length.out = n + 1)
    W <- c(0, cumsum(sqrt(dt) * rnorm(n)))
    St <- So * exp((mu - 0.5 * sigma^2) * t + sigma * W)
    plot(St, type = "l", col = "salmon",
         main = "Simulación del precio a 6 meses",
         xlab = "Días",
         ylab = "Precio")
    grid()
    ```

```{r}
sim <-  100000
p_final <- numeric(sim)
for (i in 1:sim) {
  W <- c(0,cumsum(sqrt(dt)*rnorm(252)))
  St <- So*exp((mu-0.5*sigma^2)*t+sigma*W)
  p_final[i]=St[n]
}

```

-   

-   Prob. Precio aumente o disminuya en 6 meses

    ```{r}

    mean(p_final > So)
    mean(p_final < So)
    ```

    ```{r}
    mean(p_final > So)
    mean(p_final < So)

    ```

-   Prob. Incremente 30% de su valor actual en 6 meses

    ```{r}

    mean(p_final > (1.3 * So))

    ```

-   Intervalo de confianza al 95% para 6 meses

    ```{r}
    quantile(p_final, 0.025)
    quantile(p_final, 0.975)
    ```

    ```{r}
    T <- 1   
    n <- T / dt 
    t <- seq(0, T, length.out = n + 1)
    W <- c(0, cumsum(sqrt(dt) * rnorm(n)))
    St <- So * exp((mu - 0.5 * sigma^2) * t + sigma * W)
    plot(St, type = "l", col = "salmon",
         main = "Simulación del precio 1 año",
         xlab = "Días",
         ylab = "Precio")
    grid()

    ```

    ```{r}
    sim <-  100000
    p_final <- numeric(sim)
    for (i in 1:sim) {
      W <- c(0,cumsum(sqrt(dt)*rnorm(252)))
      St <- So*exp((mu-0.5*sigma^2)*t+sigma*W)
      p_final[i]=St[n]
    }
    ```

-   Prob. Precio aumente o disminuya en 1 año

```{r}
mean(p_final > So)
mean(p_final < So)
```

-   Prob. incremente 30% de su valor actual en 1 año

```{r}
mean(p_final > (1.3 * So))
```

-   Intervalo de confianza al 95% para 1 año

    ```{r}
    quantile(p_final, 0.025)
    quantile(p_final, 0.975)
    ```
